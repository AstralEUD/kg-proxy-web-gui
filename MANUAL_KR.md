# ArmaGuard (KG-Proxy) μ‚¬μ©μ λ§¤λ‰΄μ–Ό

**ArmaGuard**λ” Arma 3 λ° Arma Reforger κ²μ„ μ„λ²„λ¥Ό μ„ν• κ³ μ„±λ¥ DDoS λ°©μ–΄ ν”„λ΅μ‹ λ° ν†µν•© κ΄€λ¦¬ μ‹μ¤ν…μ…λ‹λ‹¤. 
Vultr DDoS Protection, WireGuard VPN ν„°λ„λ§, eBPF/XDP κΈ°λ°μ κ³ μ† νΈλν”½ ν•„ν„°λ§μ„ κ²°ν•©ν•μ—¬ κ°•λ ¥ν• λ³΄μ•μ„ μ κ³µν•λ©°, μ›Ή GUIλ¥Ό ν†µν•΄ μ†μ‰½κ² κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.

## π“ λ©μ°¨

1. [κ°μ” λ° μ•„ν‚¤ν…μ²](#1-κ°μ”-λ°-μ•„ν‚¤ν…μ²)
2. [μ‹μ¤ν… μ”κµ¬μ‚¬ν•­](#2-μ‹μ¤ν…-μ”κµ¬μ‚¬ν•­)
3. [μ„¤μΉ λ° λ°°ν¬](#3-μ„¤μΉ-λ°-λ°°ν¬)
4. [λ„¤νΈμ›ν¬ μ„¤κ³„](#4-λ„¤νΈμ›ν¬-μ„¤κ³„)
5. [μ‹μ¤ν… μ„¤μ • λ° μ΄μ](#5-μ‹μ¤ν…-μ„¤μ •-λ°-μ΄μ)
6. [κ³ κΈ‰ DDoS λ°©μ–΄ κ·μΉ™](#6-κ³ κΈ‰-ddos-λ°©μ–΄-κ·μΉ™)
7. [λ¬Έμ  ν•΄κ²° (Troubleshooting)](#7-λ¬Έμ -ν•΄κ²°-troubleshooting)

---

## 1. κ°μ” λ° μ•„ν‚¤ν…μ²

μ΄ μ‹μ¤ν…μ€ ν΄λΌμ΄μ–ΈνΈμ—κ² ν”„λ΅μ‹ μ„λ²„(Vultr)μ IPλ§ λ…Έμ¶ν•κ³ , μ‹¤μ  κ²μ„ μ„λ²„(Origin)λ” WireGuard VPN λ’¤μ— μ¨κ²¨ λ³΄νΈν•©λ‹λ‹¤.

### ν•µμ‹¬ κΈ°λ¥
- **DDoS 1μ°¨ λ°©μ–΄**: Vultr DDoS Protection (10Gbps+ L3/L4 λ°©μ–΄)
- **DDoS 2μ°¨ λ°©μ–΄**: μμ²΄ eBPF/XDP λ° iptables/ipset κΈ°λ° ν•„ν„°λ§
    - **GeoIP**: ν—μ©λ κµ­κ°€(κΈ°λ³Έ: ν•κµ­) μ™Έ νΈλν”½ μ°¨λ‹¨
    - **Flood Protection**: UDP/ICMP/SYN Flood μ™„ν™”
    - **Smart Blocking**: VPN/TOR/μ•…μ„± μ¤μΊλ„ μλ™ μ°¨λ‹¨
- **μ›λ³Έ IP λ³΄μ΅΄**: Full-tunnel WireGuard κµ¬μ„±μ„ ν†µν•΄ ν”„λ΅μ‹λ¥Ό κ²½μ ν•λ”λΌλ„ κ²μ„ μ„λ²„μ—μ„ **ν΄λΌμ΄μ–ΈνΈμ μ‹¤μ  IP**λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤.
- **ν†µν•© μ›Ή GUI**: μ¤λ¦¬μ§„ κ΄€λ¦¬, λ°©ν™”λ²½ μ •μ±… μ„¤μ •, νΈλν”½ λ¨λ‹ν„°λ§μ„ μ›Ήμ—μ„ μν–‰

---

## 2. μ‹μ¤ν… μ”κµ¬μ‚¬ν•­

### ν•λ“μ›¨μ–΄ (ν”„μ„Έ)
- **VPS**: Vultr Seoul λ¦¬μ „ κ¶μ¥ (DDoS Protection μµμ… **ν•„μ**)
- **OS**: Ubuntu 22.04 LTS λλ” Debian 12 (μ»¤λ„ 5.15+ ν•„μ)
- **CPU/RAM**: μµμ† 2 vCPU / 4GB RAM κ¶μ¥ (eBPF λ§µ λ©”λ¨λ¦¬ ν™•λ³΄μ©)
- **Network**: κ³µμΈ IPv4 μ£Όμ† 1κ°

### ν•λ“μ›¨μ–΄ (μ¤λ¦¬μ§„/κ²μ„μ„λ²„)
- **OS**: Windows λλ” Linux
- **λ„¤νΈμ›ν¬**: μ™Έλ¶€ μΈν„°λ„· μ ‘μ† κ°€λ¥ (NAT ν™κ²½ λ¬΄κ΄€)
- **μ†ν”„νΈμ›¨μ–΄**: WireGuard ν΄λΌμ΄μ–ΈνΈ

---

## 3. μ„¤μΉ λ° λ°°ν¬

### 3.1 μ†μ¤ λΉλ“ (λ΅μ»¬ PC)

Go(λ°±μ—”λ“)μ™€ React(ν”„λ΅ νΈμ—”λ“) λΉλ“ ν™κ²½μ΄ ν•„μ”ν•©λ‹λ‹¤. `package.ps1` μ¤ν¬λ¦½νΈλ¥Ό μ‚¬μ©ν•μ—¬ λ°°ν¬ ν¨ν‚¤μ§€λ¥Ό μƒμ„±ν•©λ‹λ‹¤.

```powershell
# Windows ν™κ²½
./package.ps1
```
λΉλ“κ°€ μ™„λ£λλ©΄ `pkg/` λ””λ ‰ν† λ¦¬μ— μ„¤μΉ νμΌλ“¤μ΄ μƒμ„±λ©λ‹λ‹¤.

### 3.2 μ„λ²„ μ„¤μΉ (Linux ν”„λ΅μ‹)

μƒμ„±λ νμΌλ“¤μ„ μ„λ²„μ `/opt/kg-proxy` λ””λ ‰ν† λ¦¬μ— μ—…λ΅λ“ν• ν›„ μ„¤μΉ μ¤ν¬λ¦½νΈλ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.

```bash
cd /opt/kg-proxy
chmod +x install.sh
sudo ./install.sh
```

μ„¤μΉ μ¤ν¬λ¦½νΈλ” λ‹¤μμ„ μν–‰ν•©λ‹λ‹¤:
1. ν•„μ ν¨ν‚¤μ§€(`wireguard`, `ipset`, `iptables` λ“±) μ„¤μΉ
2. `kg-proxy` μ‹μ¤ν… μ„λΉ„μ¤ λ“±λ΅ λ° μ‹μ‘
3. μ΄κΈ° λ°©ν™”λ²½ κ·μΉ™ μ μ©

---

## 4. λ„¤νΈμ›ν¬ μ„¤κ³„

ν”„λ΅μ‹μ™€ μ¤λ¦¬μ§„ κ°„μ ν†µμ‹ μ€ WireGuard λ‚΄λ¶€λ§(`10.200.0.0/24`)μ„ μ‚¬μ©ν•©λ‹λ‹¤.

### 4.1 μ£Όμ† μ²΄κ³„
- **ν”„λ΅μ‹ (Gateway)**: `10.200.0.1`
- **μ¤λ¦¬μ§„ 1**: `10.200.0.2`
- **μ¤λ¦¬μ§„ 2**: `10.200.0.3`
- ... (μµλ€ 253κ° μ¤λ¦¬μ§„)

### 4.2 ν¬νΈ λ§¤ν•‘ (μμ‹)
μ™Έλ¶€ ν¬νΈλ” ν”„λ΅μ‹μ—μ„ μ„¤μ •ν•κ³ , λ‚΄λ¶€μ μΌλ΅ μ¤λ¦¬μ§„μ κ³ μ • ν¬νΈλ΅ ν¬μ›λ”©ν•©λ‹λ‹¤.

| μ„λΉ„μ¤ | μ™Έλ¶€ ν¬νΈ (ν”„λ΅μ‹) | λ‚΄λ¶€ IP (μ¤λ¦¬μ§„) | λ‚΄λ¶€ ν¬νΈ |
|---|---|---|---|
| Arma Reforger 1 | 20001 (UDP) | 10.200.0.2 | 20001 |
| Arma Reforger 2 | 20011 (UDP) | 10.200.0.3 | 20001 |
| Arma 3 Server 1 | 2302 (UDP/TCP) | 10.200.0.2 | 2302 |

---

## 5. μ‹μ¤ν… μ„¤μ • λ° μ΄μ

μ›Ή GUI(`http://<PROXY-IP>:8080` κΈ°λ³Έκ°’)μ— μ ‘μ†ν•μ—¬ κ΄€λ¦¬ν•©λ‹λ‹¤.

### 5.1 μ¤λ¦¬μ§„ λ“±λ΅ (Origins)
1. **Origins** λ©”λ‰΄μ—μ„ **Add Origin** ν΄λ¦­.
2. μ΄λ¦„κ³Ό λ‚΄λ¶€ IP(μ: `10.200.0.2`) μ…λ ¥.
3. μƒμ„±λ **Public Key**μ™€ **Config**λ¥Ό ν™•μΈ.
4. μ¤λ¦¬μ§„ μ„λ²„μ— WireGuardλ¥Ό μ„¤μΉν•κ³  ν•΄λ‹Ή Configλ¥Ό μ μ©.

### 5.2 μ„λΉ„μ¤ μ—°κ²° (Services)
1. **Services** λ©”λ‰΄μ—μ„ **Add Service** ν΄λ¦­.
2. μ„λΉ„μ¤ μ ν•(Reforger, Arma 3 λ“±) μ„ νƒ.
3. μ—°κ²°ν•  μ¤λ¦¬μ§„ μ„ νƒ λ° μ™Έλ¶€ ν¬νΈ μ§€μ •.
4. **Apply Rules**λ¥Ό λλ¬ λ°©ν™”λ²½ κ·μΉ™ κ°±μ‹ .

### 5.3 λ°©μ–΄ μ •μ±… (Policy)
- **GeoIP Blocking**: ν•κµ­(KR) μ™Έ κµ­κ°€ μ°¨λ‹¨ ν™μ„±ν™”/λΉ„ν™μ„±ν™”.
- **Whitelist**: ν•΄μ™Έ μ ‘μ†μ΄ ν•„μ”ν• νΉμ • ν”λ μ΄μ–΄ IP λ“±λ΅.
- **Blacklist**: μ•…μ„± IP μλ™ μ°¨λ‹¨.

---

## 6. κ³ κΈ‰ DDoS λ°©μ–΄ κ·μΉ™

κΈ°λ³Έμ μΈ λ°©μ–΄ μ™Έμ— μ»¤λ„ νλΌλ―Έν„° νλ‹μ„ ν†µν•΄ λ³΄μ•μ„ κ°•ν™”ν•  μ μμµλ‹λ‹¤. `/etc/sysctl.d/99-ddos.conf` νμΌμ„ μƒμ„±ν•μ—¬ μ μ©ν•©λ‹λ‹¤.

```ini
# SYN Flood λ°©μ–΄
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_max_syn_backlog = 4096

# μ—°κ²° μ¶”μ  μµμ ν™”
net.netfilter.nf_conntrack_max = 2000000
net.netfilter.nf_conntrack_tcp_timeout_established = 600

# IP μ¤ν‘Έν•‘ λ°©μ§€
net.ipv4.conf.all.rp_filter = 1
```

---

## 7. λ¬Έμ  ν•΄κ²° (Troubleshooting)

### Q1. ν΄λΌμ΄μ–ΈνΈκ°€ μ ‘μ†ν•  μ μ—†μµλ‹λ‹¤.
- **λ°©ν™”λ²½ ν™•μΈ**: `iptables -L -n -v`λ΅ ν¨ν‚·μ΄ DROPλλ”μ§€ ν™•μΈ.
- **ν¬νΈ ν™•μΈ**: `ss -tuln`μΌλ΅ ν”„λ΅μ‹κ°€ ν•΄λ‹Ή ν¬νΈλ¥Ό λ¦¬μ¤λ‹ μ¤‘μΈμ§€ ν™•μΈ.
- **WireGuard**: `wg show`λ΅ μ¤λ¦¬μ§„κ³Ό ν•Έλ“μ…°μ΄ν¬κ°€ μ„±κ³µν–λ”μ§€ ν™•μΈ.

### Q2. κ²μ„ μ„λ²„μ—μ„ λ¨λ“  ν”λ μ΄μ–΄ IPκ°€ ν”„λ΅μ‹ IPλ΅ λ³΄μ…λ‹λ‹¤.
- **μ›μΈ**: SNAT(Masquerade)κ°€ μλ» μ μ©λ κ²½μ°μ…λ‹λ‹¤.
- **ν•΄κ²°**: ν”„λ΅μ‹μ `POSTROUTING` μ²΄μΈμ—μ„ μ¤λ¦¬μ§„μΌλ΅ κ°€λ” νΈλν”½μ—λ” SNATμ„ μ μ©ν•μ§€ μ•μ•„μ•Ό ν•©λ‹λ‹¤(DNATλ§ μ μ©). μ¤λ¦¬μ§„μ WireGuard μ„¤μ •μ—μ„ `AllowedIPs`κ°€ μ¬λ°”λ¥΄κ² μ„¤μ •λμ—λ”μ§€ ν™•μΈν•μ„Έμ”.

### Q3. "Blocked" μƒνƒμΈλ° λ§µμ— μ• λΉλ‹λ‹¤.
- μµμ‹  λ²„μ „μ—μ„λ” μ°¨λ‹¨λ IPμ κµ­κ°€ μ •λ³΄λ¥Ό eBPFμ—μ„ μμ§‘ν•μ—¬ λ§µμ— ν‘μ‹ν•©λ‹λ‹¤.
- GeoIP λ°μ΄ν„°λ² μ΄μ¤κ°€ μ—…λ°μ΄νΈλμ—λ”μ§€ ν™•μΈν•μ„Έμ”.
